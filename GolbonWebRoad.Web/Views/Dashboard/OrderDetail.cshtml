@using GolbonWebRoad.Domain.Entities
@model Order
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جزئیات سفارش #@Model.Id - Tecture</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root { --bg-color:#121212; --primary-text-color:#FFFFFF; --secondary-text-color:#a0a0a0; --card-bg-color:#1a1a1a; --border-color:#333333; --accent-color:#4a90e2; }
        body.light-mode { --bg-color:#f4f4f5; --card-bg-color:#FFFFFF; --primary-text-color:#18181b; --secondary-text-color:#71717a; --border-color:#e4e4e7; }
        * { box-sizing: border-box; margin:0; padding:0; }
        body { font-family: 'Manrope', sans-serif; background:var(--bg-color); color:var(--primary-text-color); }
        a { color: var(--primary-text-color); text-decoration:none; }
        .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
        .main-header { background-color: rgba(18,18,18,0.8); border-bottom:1px solid var(--border-color); padding:15px 0; position:sticky; top:0; z-index:10; }
        body.light-mode .main-header { background-color: rgba(229,231,235,0.8); }
        .header-container { display:flex; justify-content:space-between; align-items:center; }
        #theme-toggle{cursor:pointer}

        .page-header{ padding:50px 0; background:var(--card-bg-color); text-align:center; border-bottom:1px solid var(--border-color) }
        .page-header h1{ font-size:2rem; font-weight:800 }

        .order-wrapper{ display:grid; grid-template-columns: 1.5fr 1fr; gap:24px; padding:30px 0 }
        .card{ background:var(--card-bg-color); border:1px solid var(--border-color); border-radius:12px; padding:20px }
        .card h2{ font-size:1.2rem; margin-bottom:16px; border-bottom:1px solid var(--border-color); padding-bottom:10px }
        .meta{ display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px }
        .meta .row{ display:flex; justify-content:space-between; color:var(--secondary-text-color) }

        .items .item{ display:grid; grid-template-columns: 64px 1fr auto; gap:12px; align-items:center; padding:12px 0; border-bottom:1px solid var(--border-color) }
        .items .item:last-child{ border-bottom:none }
        .items .thumb img{ width:64px; height:64px; object-fit:cover; border-radius:8px }
        .items .name{ font-weight:700 }
        .badge{ display:inline-block; padding:4px 10px; border-radius:999px; border:1px solid var(--border-color); font-size:.8rem; color:var(--secondary-text-color) }
        .total{ display:flex; justify-content:space-between; margin-top:12px; font-weight:700 }
        .footer-actions{ display:flex; justify-content:space-between; align-items:center; margin-top:18px }
        .btn{ background:var(--accent-color); border:2px solid var(--accent-color); color:#fff; padding:10px 16px; border-radius:8px; cursor:pointer; text-align:center }
        .btn-outline{ background:transparent; color:var(--accent-color) }
        @@media (max-width: 992px) { .order-wrapper{ grid-template-columns:1fr } }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container header-container">
            <a asp-controller="Dashboard" asp-action="Index" class="logo"><i class="fa-solid fa-arrow-right"></i> بازگشت</a>
            <div id="theme-toggle"><i class="fas fa-moon"></i><i class="fas fa-sun"></i></div>
        </div>
    </header>

    <main>
        <div class="page-header">
            <h1>سفارش #@Model.Id</h1>
        </div>
        <div class="container order-wrapper">
            <section class="card items">
                <h2>آیتم‌های سفارش</h2>
                @if (Model.OrderItems != null && Model.OrderItems.Any())
                {
                    foreach (var it in Model.OrderItems)
                    {
                        var product = it.ProductVariant?.Product;
                        var title = product?.Name ?? $"Variant #{it.ProductVariantId}";
                        var img = product?.MainImageUrl ?? product?.Images?.FirstOrDefault()?.ImageUrl ?? "https://placehold.co/120x120/EFEFEF/AAAAAA?text=No+Image";
                        var attrs = it.ProductVariant?.AttributeValues != null && it.ProductVariant.AttributeValues.Any()
                            ? string.Join(" / ", it.ProductVariant.AttributeValues.Select(av => (av.Attribute != null ? av.Attribute.Name + ": " : "") + av.Value))
                            : "";
                        <div class="item">
                            <div class="thumb"><img src="@img" alt="@title" /></div>
                            <div>
                                <div class="name">@title</div>
                                <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
                                    @if (!string.IsNullOrEmpty(attrs))
                                    {<div class="badge">@attrs</div>}
                                    <div class="badge">تعداد: @it.Quantity</div>
                                </div>
                            </div>
                            <div class="price">@((it.Price * it.Quantity).ToString("N0")) تومان</div>
                        </div>
                    }
                }
                <div class="total"><span>جمع کل</span><span>@Model.TotalAmount.ToString("N0") تومان</span></div>
            </section>

            <aside class="card">
                <h2>اطلاعات سفارش</h2>
                <div class="meta">
                    <div class="row"><span>وضعیت</span><strong>@Model.OrderStatus</strong></div>
                    <div class="row"><span>تاریخ</span><strong>@Model.OrderDate.ToString("yyyy/MM/dd HH:mm")</strong></div>
                    <div class="row"><span>کاربر</span><strong>@Model.User?.UserName</strong></div>
                </div>
                <div style="margin-top:16px; border-top:1px solid var(--border-color); padding-top:14px;">
                    <h3 style="font-size:1.05rem; margin-bottom:10px;">آدرس ارسال</h3>
                    @if (Model.Address != null)
                    {
                        <p class="mb-1"><strong>@($"{Model.Address.User.FirstName} {Model.Address.User.LastName}")</strong> <span class="muted">(@Model.Address.Phone)</span></p>
                        <p class="muted" style="margin:0">@Model.Address.AddressLine، @Model.Address.City، @Model.Address.Province - @Model.Address.PostalCode</p>
                    }
                    else
                    {
                        <p class="muted">آدرسی ثبت نشده است.</p>
                    }
                </div>
                <div class="footer-actions">
                    <a asp-controller="Dashboard" asp-action="Index" class="btn btn-outline">بازگشت به پیشخوان</a>
                    <a asp-controller="Products" asp-action="Index" class="btn">ادامه خرید</a>
                </div>
            </aside>
        </div>
    </main>

    <script>
        (function themeSwitcher(){
            const btn=document.getElementById('theme-toggle');
            const body=document.body; const t=localStorage.getItem('theme'); if(t==='light'){ body.classList.add('light-mode'); }
            btn.addEventListener('click', function(){ body.classList.toggle('light-mode'); localStorage.setItem('theme', body.classList.contains('light-mode') ? 'light' : 'dark'); });
        })();
    </script>
</body>
</html>

